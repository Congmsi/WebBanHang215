@model WebBanHang215.Areas.admin.ViewModels.SanPhamFilterViewModel
@using X.PagedList.Mvc.Core
@using X.PagedList

@{
    ViewData["Title"] = "Danh sách lọc sản phẩm";
    Layout = "~/Areas/admin/Views/HomeAdmin/_LayoutAdminCustom.cshtml";
    int stt = (Model.KetQua.PageNumber - 1) * Model.KetQua.PageSize + 1;
}

@section FilterSidebar {
    @*<form id="filterForm" method="get" asp-area="admin" asp-controller="HomeAdmin" asp-action="DanhSachLocSanPham">

        <!-- TỪ KHÓA -->
        <div class="border-bottom mb-4 pb-4">
            <h5 class="font-weight-semi-bold mb-4">Từ khóa</h5>
            <input type="text" name="tuKhoa" value="@Model.TuKhoa" class="form-control mb-2" placeholder="Nhập tên sản phẩm..." style="width: 100px;"  />
            <input type="hidden" name="locTuKhoa" value="false" />
            <div class="form-check">
                <input type="checkbox" name="locTuKhoa" class="form-check-input" value="true" @(Model.LocTuKhoa ? "checked" : "") />
                <label class="form-check-label">Lọc theo từ khóa</label>
            </div>
        </div>

        <!-- LOẠI SẢN PHẨM -->
        <div class="border-bottom mb-4 pb-4">
            <h5 class="font-weight-semi-bold mb-4">Loại sản phẩm</h5>
            <select name="maLoai" class="form-control mb-2">
                <option value="">-- Chọn loại --</option>
                @foreach (var loai in Model.LoaiSanPhams ?? new List<SelectListItem>())
                {
                    <option value="@loai.Value" @(Model.MaLoai.ToString() == loai.Value ? "selected" : "")>@loai.Text</option>
                }
            </select>
            <input type="hidden" name="locLoai" value="false" />
            <div class="form-check">
                <input type="checkbox" name="locLoai" class="form-check-input" value="true" @(Model.LocLoai ? "checked" : "") />
                <label class="form-check-label">Lọc theo loại</label>
            </div>
        </div>

        <!-- KHOẢNG GIÁ -->
        <div class="border-bottom mb-4 pb-4">
            <h5 class="font-weight-semi-bold mb-4">Khoảng giá</h5>
            <input type="number" step="1000" name="giaTu" value="@Model.GiaTu" placeholder="Giá từ..." class="form-control mb-2" />
            <input type="number" step="1000" name="giaDen" value="@Model.GiaDen" placeholder="Giá đến..." class="form-control mb-2" />
            <input type="hidden" name="locGia" value="false" />
            <div class="form-check">
                <input type="checkbox" name="locGia" class="form-check-input" value="true" @(Model.LocGia ? "checked" : "") />
                <label class="form-check-label">Lọc theo giá</label>
            </div>
        </div>

        <div class="text-center mt-3">
            <button type="submit" class="btn btn-primary">Lọc sản phẩm</button>
        </div>
    </form>*@
    <form id="filterForm" method="get" asp-area="admin" asp-controller="HomeAdmin" asp-action="DanhSachLocSanPham">
        <!-- TỪ KHÓA -->
        <div class="border-bottom mb-4 pb-4">
            <h5 class="font-weight-semi-bold mb-3">Từ khóa</h5>
            <input type="text" name="tuKhoa" value="@Model.TuKhoa" class="form-control mb-2 w-50" placeholder="Nhập tên sản phẩm..." />
            <input type="hidden" name="locTuKhoa" value="false" />
            <div class="form-check">
                <input type="checkbox" name="locTuKhoa" class="form-check-input" value="true" @(Model.LocTuKhoa ? "checked" : "") />
                <label class="form-check-label ms-1">Lọc theo từ khóa</label>
            </div>
        </div>

        <!-- LOẠI SẢN PHẨM -->
        <div class="border-bottom mb-4 pb-4">
            <h5 class="font-weight-semi-bold mb-3">Loại sản phẩm</h5>
            <select name="maLoai" class="form-control mb-2 w-50">
                <option value="">-- Chọn loại --</option>
                @foreach (var loai in Model.LoaiSanPhams ?? new List<SelectListItem>())
                {
                    <option value="@loai.Value" @(Model.MaLoai.ToString() == loai.Value ? "selected" : "")>@loai.Text</option>
                }
            </select>
            <input type="hidden" name="locLoai" value="false" />
            <div class="form-check">
                <input type="checkbox" name="locLoai" class="form-check-input" value="true" @(Model.LocLoai ? "checked" : "") />
                <label class="form-check-label ms-1">Lọc theo loại</label>
            </div>
        </div>

        <!-- KHOẢNG GIÁ -->
        <!-- KHOẢNG GIÁ -->
        @*<div class="border-bottom mb-4 pb-4">
            <h5 class="font-weight-semi-bold mb-3">Khoảng giá</h5>
            <input type="number" step="1000" name="giaTu" value="@Model.GiaTu" placeholder="Giá từ..." class="form-control mb-2 w-50" />
            <input type="number" step="1000" name="giaDen" value="@Model.GiaDen" placeholder="Giá đến..." class="form-control mb-2 w-50" />
            <input type="hidden" name="locGia" value="false" />
            <div class="form-check">
                <input type="checkbox" name="locGia" class="form-check-input" value="true" @(Model.LocGia ? "checked" : "") />
                <label class="form-check-label ms-1">Lọc theo giá</label>
            </div>
        </div>


        <div class="text-center">
            <button type="submit" class="btn btn-primary">Lọc sản phẩm</button>
        </div>*@
        <div class="border-bottom pb-4">
            <h5 class="font-weight-semi-bold mb-3">Khoảng giá</h5>
            <input type="number" step="1000" name="giaTu" value="@Model.GiaTu" placeholder="Giá từ..." class="form-control mb-2 w-50" />
            <input type="number" step="1000" name="giaDen" value="@Model.GiaDen" placeholder="Giá đến..." class="form-control mb-2 w-50" />
            <input type="hidden" name="locGia" value="false" />
            <div class="form-check">
                <input type="checkbox" name="locGia" class="form-check-input" value="true" @(Model.LocGia ? "checked" : "") />
                <label class="form-check-label ms-1">Lọc theo giá</label>
            </div>
            <!-- Đưa nút vào đây -->
            <div class="text-lg-left">
                <button type="submit" class="btn btn-primary">Lọc sản phẩm</button>
            </div>
        </div>

    </form>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('filterForm');
            form.addEventListener('submit', function () {
                ['locTuKhoa', 'locLoai', 'locGia'].forEach(function (name) {
                    const checkbox = form.querySelector('input[name="' + name + '"][type="checkbox"]');
                    const hidden = form.querySelector('input[name="' + name + '"][type="hidden"]');
                    if (checkbox && checkbox.checked && hidden) {
                        hidden.remove();  // Xóa input ẩn nếu checkbox được tick
                    }
                });
            });
        });
    </script>
}

<table class="table table-bordered text-center">
    <thead class="table-success">
        <tr>
            <th>STT</th>
            <th>Tên SP</th>
            <th>Mô Tả</th>
            <th>Giá</th>
            <th>Giá Nhập</th>
            <th>Giá KM</th>
            <th>Số lượng</th>
        </tr>
    </thead>
    <tbody>
        @{
            int Mau = 0;
            string MauSD = "";
        }
        @foreach (var item in Model.KetQua)
        {
            switch (Mau % 4)
            {
                case 0: MauSD = "table-primary"; break;
                case 1: MauSD = "table-warning"; break;
                case 2: MauSD = "table-success"; break;
                default: MauSD = "table-danger"; break;
            }
            Mau++;
            <tr class="@MauSD">
                <td>@stt</td>
                <td>@item.TenSp</td>
                <td>@item.MoTa</td>
                <td>@item.Gia?.ToString("N2")</td>
                <td>@item.GiaNhap?.ToString("N2")</td>
                <td>@item.GiaKhuyenMai?.ToString("N2")</td>
                <td>@item.SoLuongNhap</td>
            </tr>
            stt++;
        }
    </tbody>
</table>

<!-- Pagination -->
<div class="text-center">
    @Html.PagedListPager(Model.KetQua, page => Url.Action("DanhSachLocSanPham", new
        {
            page,
            tuKhoa = Model.TuKhoa,
            maLoai = Model.MaLoai,
            locTuKhoa = Model.LocTuKhoa,
            locLoai = Model.LocLoai,
            locGia = Model.LocGia,
            giaTu = Model.GiaTu,
            giaDen = Model.GiaDen
        }), new PagedListRenderOptions
{
    DisplayLinkToPreviousPage = PagedListDisplayMode.Always,
    DisplayLinkToNextPage = PagedListDisplayMode.Always,
    UlElementClasses = new[] { "pagination justify-content-center" },
    LiElementClasses = new[] { "page-item" },
    PageClasses = new[] { "page-link" }
})
</div>
